# üèóÔ∏è Diagramas de Arquitetura - ProfAi TCC Editor

## üìê Arquitetura Geral do Sistema

```mermaid
graph TB
    subgraph "Frontend (React + TypeScript)"
        UI[üñ•Ô∏è Interface do Usu√°rio]
        Editor[‚úèÔ∏è Editor de Texto]
        ProfAi[ü§ñ Assistente ProfAi]
        Auth[üîê Autentica√ß√£o]
    end
    
    subgraph "Backend (Node.js + Express)"
        API[üîå API REST]
        Auth_Service[üîë Servi√ßo de Auth]
        Document_Service[üìÑ Servi√ßo de Documentos]
        AI_Service[üß† Servi√ßo de IA]
        Export_Service[üì§ Servi√ßo de Export]
    end
    
    subgraph "Banco de Dados"
        PostgreSQL[(üóÑÔ∏è PostgreSQL)]
    end
    
    subgraph "Servi√ßos Externos"
        UNIFOR[üè´ OAuth UNIFOR]
        Scholar[üìö Google Scholar API]
        Storage[‚òÅÔ∏è File Storage]
    end
    
    subgraph "Infraestrutura"
        Docker[üê≥ Docker Containers]
        Nginx[üåê Nginx Proxy]
        SSL[üîí SSL/TLS]
    end
    
    UI --> API
    Editor --> Document_Service
    ProfAi --> AI_Service
    Auth --> Auth_Service
    
    API --> PostgreSQL
    Auth_Service --> UNIFOR
    AI_Service --> Scholar
    Export_Service --> Storage
    
    Docker --> Nginx
    Nginx --> SSL
```

---

## üîÑ Fluxo de Dados Principal

```mermaid
sequenceDiagram
    participant U as üë§ Usu√°rio
    participant F as üñ•Ô∏è Frontend
    participant B as ‚öôÔ∏è Backend
    participant DB as üóÑÔ∏è Database
    participant AI as ü§ñ IA Service
    participant PA as üéì ProfAi
    
    U->>F: 1. Digita texto no editor
    F->>F: 2. Debounce (3s)
    F->>AI: 3. Analisa texto
    AI->>AI: 4. Processa corre√ß√µes
    AI->>F: 5. Retorna sugest√µes
    F->>PA: 6. Notifica ProfAi
    PA->>PA: 7. Gera mensagem contextual
    PA->>F: 8. Exibe corre√ß√µes + mensagem
    F->>U: 9. Mostra na sidebar
    
    U->>F: 10. Aceita corre√ß√£o
    F->>F: 11. Aplica no editor
    F->>B: 12. Salva documento
    B->>DB: 13. Persiste dados
    DB->>B: 14. Confirma salvamento
    B->>F: 15. Retorna sucesso
    F->>PA: 16. Atualiza progresso
    PA->>F: 17. Celebra conquista
```

---

## üß© Arquitetura de Componentes Frontend

```mermaid
graph TB
    subgraph "App.tsx - Aplica√ß√£o Principal"
        Router[üõ£Ô∏è React Router]
        Providers[üîÑ Context Providers]
    end
    
    subgraph "Contexts (Estado Global)"
        AuthContext[üîê AuthContext]
        EditorContext[üìù EditorContext]
        ProfAiContext[ü§ñ ProfAiContext]
    end
    
    subgraph "Pages (P√°ginas)"
        Home[üè† Home]
        EditorUnified[‚úèÔ∏è EditorUnified]
        History[üìö History]
        About[‚ÑπÔ∏è About]
        Login[üîë Login]
    end
    
    subgraph "Components (Componentes)"
        Header[üìã Header]
        WordLikeEditor[üìù WordLikeEditor]
        FileUpload[üì§ FileUpload]
        Toolbar[üõ†Ô∏è Toolbar]
        Sidebar[üìä Sidebar]
    end
    
    subgraph "Utils (Utilit√°rios)"
        TCCFormatter[üìê SmartTCCFormatter]
        ExportUtils[üì§ Export Utils]
        ValidationUtils[‚úÖ Validation Utils]
    end
    
    Router --> Pages
    Providers --> Contexts
    Pages --> Components
    Components --> Utils
    
    EditorUnified --> WordLikeEditor
    EditorUnified --> Sidebar
    WordLikeEditor --> TCCFormatter
    FileUpload --> ValidationUtils
```

---

## üóÑÔ∏è Modelo de Dados (Banco PostgreSQL)

```mermaid
erDiagram
    USERS {
        uuid id PK
        string name
        string email UK
        string course
        string university
        string avatar_url
        boolean is_unifor_user
        timestamp last_login
        jsonb preferences
        timestamp created_at
        timestamp updated_at
    }
    
    DOCUMENTS {
        uuid id PK
        uuid user_id FK
        string title
        text content
        text original_content
        integer progress
        integer word_count
        integer chapter_count
        timestamp created_at
        timestamp updated_at
    }
    
    CORRECTIONS {
        uuid id PK
        uuid document_id FK
        string type
        string severity
        text message
        text original_text
        text suggested_text
        jsonb position
        boolean accepted
        boolean rejected
        boolean applied
        text explanation
        string chapter
        timestamp created_at
    }
    
    VERSIONS {
        uuid id PK
        uuid document_id FK
        text content
        jsonb changes
        integer word_count
        text description
        timestamp created_at
    }
    
    ACHIEVEMENTS {
        uuid id PK
        uuid user_id FK
        string achievement_type
        string title
        text description
        string icon
        integer progress
        integer max_progress
        timestamp unlocked_at
        timestamp created_at
    }
    
    PROFAI_MESSAGES {
        uuid id PK
        uuid user_id FK
        uuid document_id FK
        string type
        text content
        string priority
        string category
        jsonb position
        jsonb action
        boolean read
        timestamp created_at
    }
    
    FILE_UPLOADS {
        uuid id PK
        uuid user_id FK
        uuid document_id FK
        string filename
        string file_type
        integer file_size
        string status
        text extracted_text
        jsonb metadata
        timestamp uploaded_at
    }
    
    CITATIONS {
        uuid id PK
        uuid document_id FK
        text citation_text
        string author
        integer year
        string title
        string source
        string type
        text abnt_format
        jsonb position
        timestamp created_at
    }
    
    USERS ||--o{ DOCUMENTS : "creates"
    USERS ||--o{ ACHIEVEMENTS : "earns"
    USERS ||--o{ PROFAI_MESSAGES : "receives"
    USERS ||--o{ FILE_UPLOADS : "uploads"
    
    DOCUMENTS ||--o{ CORRECTIONS : "has"
    DOCUMENTS ||--o{ VERSIONS : "has"
    DOCUMENTS ||--o{ CITATIONS : "contains"
    DOCUMENTS ||--o{ FILE_UPLOADS : "from"
    DOCUMENTS ||--o{ PROFAI_MESSAGES : "about"
```

---

## üîå Arquitetura de APIs

```mermaid
graph TB
    subgraph "API Gateway"
        Gateway[üö™ API Gateway]
        Auth_Middleware[üîê Auth Middleware]
        Rate_Limiter[‚è±Ô∏è Rate Limiter]
        CORS[üåê CORS Handler]
    end
    
    subgraph "Authentication Service"
        OAuth[üîë OAuth Handler]
        JWT[üé´ JWT Service]
        Session[üìù Session Manager]
    end
    
    subgraph "Document Service"
        CRUD[üìÑ Document CRUD]
        Upload[üì§ File Upload]
        Export[üì• Export Service]
        Version[üîÑ Version Control]
    end
    
    subgraph "AI Service"
        TextAnalysis[üîç Text Analysis]
        Corrections[‚úÖ Correction Engine]
        ABNTFormatter[üìê ABNT Formatter]
        SmartSuggestions[üí° Smart Suggestions]
    end
    
    subgraph "ProfAi Service"
        MessageGenerator[üí¨ Message Generator]
        PersonalityEngine[üé≠ Personality Engine]
        ProgressTracker[üìä Progress Tracker]
        AchievementSystem[üèÜ Achievement System]
    end
    
    subgraph "External APIs"
        UNIFOR_OAuth[üè´ UNIFOR OAuth]
        GoogleScholar[üìö Google Scholar]
        FileStorage[‚òÅÔ∏è File Storage]
    end
    
    Gateway --> Auth_Middleware
    Auth_Middleware --> Rate_Limiter
    Rate_Limiter --> CORS
    
    CORS --> Authentication Service
    CORS --> Document Service
    CORS --> AI Service
    CORS --> ProfAi Service
    
    OAuth --> UNIFOR_OAuth
    Upload --> FileStorage
    SmartSuggestions --> GoogleScholar
```

---

## üîÑ Pipeline de Processamento de Texto

```mermaid
flowchart TD
    Start([üìù Usu√°rio digita texto]) --> Debounce{‚è±Ô∏è Debounce 3s}
    Debounce -->|Texto est√°vel| MinLength{üìè M√≠n. 100 chars?}
    MinLength -->|Sim| Extract[üî§ Extrair texto plano]
    MinLength -->|N√£o| End([‚ùå N√£o processar])
    
    Extract --> Limit[‚úÇÔ∏è Limitar 5000 chars]
    Limit --> SmartAnalysis[üß† SmartTCCFormatter]
    
    SmartAnalysis --> DetectStructure[üèóÔ∏è Detectar estrutura TCC]
    DetectStructure --> University[üè´ Universidade]
    DetectStructure --> Titles[üìã T√≠tulos]
    DetectStructure --> Subtitles[üìù Subt√≠tulos]
    DetectStructure --> Paragraphs[üìÑ Par√°grafos]
    DetectStructure --> Lists[üìã Listas]
    
    SmartAnalysis --> CommonErrors[üîç Erros comuns]
    CommonErrors --> Spelling[üìù Ortografia]
    CommonErrors --> Grammar[üìö Gram√°tica]
    CommonErrors --> Style[üé® Estilo]
    
    University --> FormatCorrections[üìê Gerar corre√ß√µes ABNT]
    Titles --> FormatCorrections
    Subtitles --> FormatCorrections
    Paragraphs --> FormatCorrections
    Lists --> FormatCorrections
    
    Spelling --> CombineCorrections[üîó Combinar corre√ß√µes]
    Grammar --> CombineCorrections
    Style --> CombineCorrections
    FormatCorrections --> CombineCorrections
    
    CombineCorrections --> FilterDuplicates[üö´ Filtrar duplicatas]
    FilterDuplicates --> PrioritizeCorrections[‚≠ê Priorizar por severidade]
    PrioritizeCorrections --> UpdateUI[üñ•Ô∏è Atualizar interface]
    
    UpdateUI --> NotifyProfAi[ü§ñ Notificar ProfAi]
    NotifyProfAi --> GenerateMessage[üí¨ Gerar mensagem contextual]
    GenerateMessage --> ShowResults([‚úÖ Exibir resultados])
```

---

## üé® Fluxo de Formata√ß√£o ABNT

```mermaid
flowchart TD
    UserClick([üë§ Usu√°rio clica "ABNT"]) --> GetText[üìÑ Obter texto do editor]
    GetText --> ClearFormat[üßπ Limpar formata√ß√£o existente]
    ClearFormat --> ApplyBase[üìù Aplicar base: Times 12pt]
    
    ApplyBase --> SplitLines[‚úÇÔ∏è Dividir em linhas]
    SplitLines --> ProcessLine{üîÑ Para cada linha}
    
    ProcessLine --> DetectType{üîç Detectar tipo}
    
    DetectType -->|UNIVERSIDADE FEDERAL| University[üè´ Formato Capa]
    DetectType -->|RESUMO, INTRODU√á√ÉO| MainTitle[üìã T√≠tulo Principal]
    DetectType -->|1 INTRODU√á√ÉO| NumberedTitle[üî¢ T√≠tulo Numerado]
    DetectType -->|1.1 Objetivos| Subtitle[üìù Subt√≠tulo]
    DetectType -->|Nome Pr√≥prio| Author[üë§ Nome Autor]
    DetectType -->|T√çTULO MAI√öSCULO| WorkTitle[üìö T√≠tulo Trabalho]
    DetectType -->|‚Ä¢ Lista| List[üìã Lista]
    DetectType -->|Texto normal| Paragraph[üìÑ Par√°grafo]
    
    University --> Format1[üìê 14pt, negrito, centro]
    MainTitle --> Format2[üìê 14pt, negrito, centro, H1]
    NumberedTitle --> Format3[üìê 14pt, negrito, esquerda, H1]
    Subtitle --> Format4[üìê 12pt, negrito, esquerda, H2]
    Author --> Format5[üìê 12pt, negrito, centro]
    WorkTitle --> Format6[üìê 16pt, negrito, centro]
    List --> Format7[üìê Lista com marcadores]
    Paragraph --> Format8[üìê 12pt, justificado, recuo]
    
    Format1 --> NextLine{‚û°Ô∏è Pr√≥xima linha?}
    Format2 --> NextLine
    Format3 --> NextLine
    Format4 --> NextLine
    Format5 --> NextLine
    Format6 --> NextLine
    Format7 --> NextLine
    Format8 --> NextLine
    
    NextLine -->|Sim| ProcessLine
    NextLine -->|N√£o| ApplySpacing[üìè Aplicar espa√ßamento 1.6]
    
    ApplySpacing --> UpdateEditor[üîÑ Atualizar editor]
    UpdateEditor --> RunAnalysis[üß† Executar an√°lise IA]
    RunAnalysis --> ShowSuccess[‚úÖ Mostrar sucesso]
    ShowSuccess --> End([üéâ Formata√ß√£o conclu√≠da])
```

---

## ü§ñ Arquitetura da ProfAi

```mermaid
graph TB
    subgraph "ProfAi Core"
        PersonalityEngine[üé≠ Personality Engine]
        MessageGenerator[üí¨ Message Generator]
        ContextAnalyzer[üîç Context Analyzer]
        ProgressTracker[üìä Progress Tracker]
    end
    
    subgraph "Personality Types"
        Empathetic[üòä Emp√°tica]
        Technical[üîß T√©cnica]
        Motivational[üöÄ Motivadora]
    end
    
    subgraph "Message Types"
        Welcome[üëã Boas-vindas]
        Correction[‚úÖ Corre√ß√£o]
        Motivation[üí™ Motiva√ß√£o]
        Tips[üí° Dicas]
        Achievement[üèÜ Conquistas]
        Explanation[üìö Explica√ß√£o]
    end
    
    subgraph "Context Inputs"
        UserProgress[üìà Progresso do Usu√°rio]
        DocumentType[üìÑ Tipo de Documento]
        CurrentChapter[üìñ Cap√≠tulo Atual]
        ErrorTypes[‚ùå Tipos de Erro]
        TimeOfDay[üïê Hora do Dia]
        SessionLength[‚è±Ô∏è Dura√ß√£o da Sess√£o]
    end
    
    subgraph "Adaptive Behavior"
        BeginnerMode[üå± Modo Iniciante]
        IntermediateMode[üìö Modo Intermedi√°rio]
        ExpertMode[üéì Modo Especialista]
    end
    
    PersonalityEngine --> Empathetic
    PersonalityEngine --> Technical
    PersonalityEngine --> Motivational
    
    MessageGenerator --> Welcome
    MessageGenerator --> Correction
    MessageGenerator --> Motivation
    MessageGenerator --> Tips
    MessageGenerator --> Achievement
    MessageGenerator --> Explanation
    
    ContextAnalyzer --> UserProgress
    ContextAnalyzer --> DocumentType
    ContextAnalyzer --> CurrentChapter
    ContextAnalyzer --> ErrorTypes
    ContextAnalyzer --> TimeOfDay
    ContextAnalyzer --> SessionLength
    
    ProgressTracker --> BeginnerMode
    ProgressTracker --> IntermediateMode
    ProgressTracker --> ExpertMode
    
    PersonalityEngine --> MessageGenerator
    ContextAnalyzer --> PersonalityEngine
    ProgressTracker --> ContextAnalyzer
```

---

## üîí Arquitetura de Seguran√ßa

```mermaid
graph TB
    subgraph "Frontend Security"
        CSP[üõ°Ô∏è Content Security Policy]
        XSS[üö´ XSS Protection]
        InputValidation[‚úÖ Input Validation]
        TokenStorage[üîê Secure Token Storage]
    end
    
    subgraph "API Security"
        HTTPS[üîí HTTPS/TLS]
        CORS[üåê CORS Policy]
        RateLimit[‚è±Ô∏è Rate Limiting]
        AuthMiddleware[üîë Auth Middleware]
    end
    
    subgraph "Authentication"
        OAuth2[üé´ OAuth2/UNIFOR]
        JWT[üîë JWT Tokens]
        RefreshToken[üîÑ Refresh Tokens]
        SessionMgmt[üìù Session Management]
    end
    
    subgraph "Data Protection"
        Encryption[üîê Data Encryption]
        Sanitization[üßπ Data Sanitization]
        Validation[‚úÖ Input Validation]
        Backup[üíæ Secure Backup]
    end
    
    subgraph "Infrastructure Security"
        Firewall[üî• Firewall]
        VPN[üåê VPN Access]
        Monitoring[üëÅÔ∏è Security Monitoring]
        Logging[üìã Audit Logging]
    end
    
    subgraph "Compliance"
        LGPD[üìã LGPD Compliance]
        DataRetention[üóÑÔ∏è Data Retention]
        UserConsent[‚úÖ User Consent]
        DataPortability[üì§ Data Portability]
    end
    
    CSP --> HTTPS
    XSS --> CORS
    InputValidation --> RateLimit
    TokenStorage --> AuthMiddleware
    
    OAuth2 --> JWT
    JWT --> RefreshToken
    RefreshToken --> SessionMgmt
    
    Encryption --> Sanitization
    Sanitization --> Validation
    Validation --> Backup
    
    Firewall --> VPN
    VPN --> Monitoring
    Monitoring --> Logging
    
    LGPD --> DataRetention
    DataRetention --> UserConsent
    UserConsent --> DataPortability
```

---

## üìä Monitoramento e Observabilidade

```mermaid
graph TB
    subgraph "Application Metrics"
        ResponseTime[‚è±Ô∏è Response Time]
        Throughput[üìà Throughput]
        ErrorRate[‚ùå Error Rate]
        UserSessions[üë• Active Sessions]
    end
    
    subgraph "Business Metrics"
        DocumentsCreated[üìÑ Documents Created]
        CorrectionsAccepted[‚úÖ Corrections Accepted]
        ExportsGenerated[üì§ Exports Generated]
        UserRetention[üîÑ User Retention]
    end
    
    subgraph "Infrastructure Metrics"
        CPUUsage[üíª CPU Usage]
        MemoryUsage[üß† Memory Usage]
        DiskSpace[üíæ Disk Space]
        NetworkIO[üåê Network I/O]
    end
    
    subgraph "AI Metrics"
        CorrectionAccuracy[üéØ Correction Accuracy]
        ProcessingTime[‚ö° AI Processing Time]
        ModelPerformance[ü§ñ Model Performance]
        FalsePositives[‚ö†Ô∏è False Positives]
    end
    
    subgraph "Alerting System"
        PerformanceAlerts[üö® Performance Alerts]
        ErrorAlerts[‚ùå Error Alerts]
        SecurityAlerts[üîí Security Alerts]
        BusinessAlerts[üìä Business Alerts]
    end
    
    subgraph "Dashboards"
        OperationalDashboard[üìä Operational Dashboard]
        BusinessDashboard[üìà Business Dashboard]
        SecurityDashboard[üîí Security Dashboard]
        AIPerformanceDashboard[ü§ñ AI Performance Dashboard]
    end
    
    ResponseTime --> PerformanceAlerts
    ErrorRate --> ErrorAlerts
    UserSessions --> SecurityAlerts
    DocumentsCreated --> BusinessAlerts
    
    PerformanceAlerts --> OperationalDashboard
    BusinessAlerts --> BusinessDashboard
    SecurityAlerts --> SecurityDashboard
    ModelPerformance --> AIPerformanceDashboard
```

---

## üöÄ Deployment Architecture

```mermaid
graph TB
    subgraph "Development Environment"
        DevFrontend[üñ•Ô∏è React Dev Server]
        DevBackend[‚öôÔ∏è Node.js Dev Server]
        DevDB[üóÑÔ∏è PostgreSQL Dev]
    end
    
    subgraph "Staging Environment"
        StagingFrontend[üñ•Ô∏è Nginx + React Build]
        StagingBackend[‚öôÔ∏è Node.js + PM2]
        StagingDB[üóÑÔ∏è PostgreSQL Staging]
    end
    
    subgraph "Production Environment"
        LoadBalancer[‚öñÔ∏è Load Balancer]
        ProdFrontend1[üñ•Ô∏è Frontend Instance 1]
        ProdFrontend2[üñ•Ô∏è Frontend Instance 2]
        ProdBackend1[‚öôÔ∏è Backend Instance 1]
        ProdBackend2[‚öôÔ∏è Backend Instance 2]
        ProdDB[üóÑÔ∏è PostgreSQL Cluster]
        Redis[üî¥ Redis Cache]
    end
    
    subgraph "CI/CD Pipeline"
        GitHub[üìÅ GitHub Repository]
        Actions[üîÑ GitHub Actions]
        Tests[üß™ Automated Tests]
        Build[üèóÔ∏è Build Process]
        Deploy[üöÄ Deployment]
    end
    
    subgraph "Monitoring & Logging"
        Prometheus[üìä Prometheus]
        Grafana[üìà Grafana]
        ELK[üìã ELK Stack]
        Alerts[üö® Alert Manager]
    end
    
    GitHub --> Actions
    Actions --> Tests
    Tests --> Build
    Build --> Deploy
    
    Deploy --> StagingFrontend
    Deploy --> ProdFrontend1
    Deploy --> ProdFrontend2
    
    LoadBalancer --> ProdFrontend1
    LoadBalancer --> ProdFrontend2
    ProdFrontend1 --> ProdBackend1
    ProdFrontend2 --> ProdBackend2
    ProdBackend1 --> ProdDB
    ProdBackend2 --> ProdDB
    ProdBackend1 --> Redis
    ProdBackend2 --> Redis
    
    ProdFrontend1 --> Prometheus
    ProdBackend1 --> ELK
    Prometheus --> Grafana
    Grafana --> Alerts
```

---

*Diagramas de Arquitetura gerados em: ${new Date().toLocaleDateString('pt-BR')}*
*Sistema: ProfAi TCC Editor v1.0.0*
